<!doctype html><html><head><meta charset="utf-8"/><title>San CLI</title><script>window['SAN_DOCIT'] = {"toc":{"level":0,"children":[{"level":2,"title":"addon组件的定义","hash":"addon%E7%BB%84%E4%BB%B6%E7%9A%84%E5%AE%9A%E4%B9%89"},{"level":2,"title":"addon挂载的基本步骤","hash":"addon%E6%8C%82%E8%BD%BD%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%AD%A5%E9%AA%A4"},{"level":2,"title":"Dashboard接入自定义部件widget","hash":"dashboard%E6%8E%A5%E5%85%A5%E8%87%AA%E5%AE%9A%E4%B9%89%E9%83%A8%E4%BB%B6widget","children":[{"level":3,"title":"1. 创建一个addon组件的工程","hash":"1.-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAaddon%E7%BB%84%E4%BB%B6%E7%9A%84%E5%B7%A5%E7%A8%8B"},{"level":3,"title":"2. 实现","hash":"2.-%E5%AE%9E%E7%8E%B0"},{"level":3,"title":"3. 注册","hash":"3.-%E6%B3%A8%E5%86%8C"},{"level":3,"title":"4. 显示","hash":"4.-%E6%98%BE%E7%A4%BA"},{"level":3,"title":"5. 在项目中加载及调试","hash":"5.-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%8A%A0%E8%BD%BD%E5%8F%8A%E8%B0%83%E8%AF%95"}]}]}};</script><base href="/san-cli/"><link rel="icon" href="/san-cli/favicon.ico"><link href="/san-cli/static/css/chunk-vendors.css" rel="stylesheet"><link href="/san-cli/static/css/client-entry.css" rel="stylesheet"></head><body><div id="app"><div id="site"><!--s-data:{"SAN_DOCIT":{"pathname":"ui/add-addon/index","content":"<div class=\"markdown\"><h1 id=\"addon%E7%BB%84%E4%BB%B6\"><a class=\"header-anchor\" href=\"#addon%E7%BB%84%E4%BB%B6\">#</a> addon组件</h1>\n<h2 id=\"addon%E7%BB%84%E4%BB%B6%E7%9A%84%E5%AE%9A%E4%B9%89\"><a class=\"header-anchor\" href=\"#addon%E7%BB%84%E4%BB%B6%E7%9A%84%E5%AE%9A%E4%B9%89\">#</a> addon组件的定义</h2>\n<p><strong>addon组件</strong>：是一个动态加载到cli-ui的js包，其结构满足CLI插件的默认包结构。项目的仪表盘内显示的部件widget、任务内的显示视图view等，都称为addon，均以单独的npm包形式存在。</p>\n<p>外部addon的，主要借助两个api实现在cli ui内的显示：</p>\n<ol>\n<li><code>api.registerAddon</code>：注册一个addon，定义加载的addon id及路径。</li>\n<li><code>api.registerWidget</code>/<code>api.registerTask</code>：注册一个widget组件/view组件，用于将自定义组件加载到dashboard/task视图内。</li>\n</ol>\n<h2 id=\"addon%E6%8C%82%E8%BD%BD%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%AD%A5%E9%AA%A4\"><a class=\"header-anchor\" href=\"#addon%E6%8C%82%E8%BD%BD%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%AD%A5%E9%AA%A4\">#</a> addon挂载的基本步骤</h2>\n<ul>\n<li>创建：创建一个addon的项目，可以为单独的npm包或者在已有的插件内增加</li>\n<li>实现：编写index.js实现自定义组件，通过cli ui提供的<code>ClientAddonApi</code>将组件定义挂载到全局</li>\n<li>注册：在ui.js文件中调用<code>api.addClientAddon</code>指定构建后的js包加载路径</li>\n<li>显示：在ui.js文件中调用指定api挂载到指定视图内，例如api.registerWidget注册组件到dashboard</li>\n</ul>\n<p>在开发addon组件过程中，会涉及到以下api：</p>\n<ul>\n<li><code>api.registerAddon</code>：addon组件注册</li>\n<li><code>api.registerWidget</code>：widget部件注册</li>\n<li><code>api.callAction</code>：事件调用</li>\n<li><code>api.onAction</code>：事件监听</li>\n<li><code>ClientAddonApi.defineComponent</code>：组件定义</li>\n<li><code>ClientAddonApi.addLocales</code>：组件扩展语言</li>\n</ul>\n<p>接下来以实际例子来展示插件的开发过程。</p>\n<h2 id=\"dashboard%E6%8E%A5%E5%85%A5%E8%87%AA%E5%AE%9A%E4%B9%89%E9%83%A8%E4%BB%B6widget\"><a class=\"header-anchor\" href=\"#dashboard%E6%8E%A5%E5%85%A5%E8%87%AA%E5%AE%9A%E4%B9%89%E9%83%A8%E4%BB%B6widget\">#</a> Dashboard接入自定义部件widget</h2>\n<p>cli ui提供了将自定义组件挂载到项目仪表盘的方式，通过此功能，你可以定制属于自己的个性仪表盘，也可将小工具分享给更多的人使用。</p>\n<p>接下来以一个逐步讲解一个新增自定义widget部件的过程，这里以图片压缩小部件<code>san-cli-ui-widget-tiny-image</code>为例，点击下文的链接可随时点击查看源码。</p>\n<h3 id=\"1.-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAaddon%E7%BB%84%E4%BB%B6%E7%9A%84%E5%B7%A5%E7%A8%8B\"><a class=\"header-anchor\" href=\"#1.-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAaddon%E7%BB%84%E4%BB%B6%E7%9A%84%E5%B7%A5%E7%A8%8B\">#</a> 1. 创建一个addon组件的工程</h3>\n<p>推荐使用san cli创建一个新的项目，作为开发依赖安装san-cli-ui，在san.config.js中填写如下内容（<a href=\"https://github.com/amazing-js/san-cli-ui-widget-tiny-image/blob/master/san.config.js\">demo参考</a>）：</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> clientAddonConfig <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'san-cli-ui/client-addon-config'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span><span class=\"token function\">clientAddonConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        id<span class=\"token operator\">:</span> <span class=\"token string\">'san.webpack.client-addon.widget.tiny-image'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 名称唯一</span>\n        port<span class=\"token operator\">:</span> <span class=\"token number\">8891</span> <span class=\"token comment\">// 端口可变</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n<blockquote>\n<p>注意：id应设置正确的命名，且在所有插件中保持唯一</p>\n</blockquote>\n<p>通过<code>clientAddonConfig</code>可生成san.config.js的默认配置，打包出的代码输出到<code>./dist/index.js</code>。</p>\n<p>demo目录结构如下：</p>\n<pre class=\"language-js\"><code class=\"language-js\">san<span class=\"token operator\">-</span>cli<span class=\"token operator\">-</span>ui<span class=\"token operator\">-</span>widget<span class=\"token operator\">-</span>tiny<span class=\"token operator\">-</span>image\n├── <span class=\"token constant\">README</span><span class=\"token punctuation\">.</span>md\n├── src\n      ├──components\n│     └── index<span class=\"token punctuation\">.</span>js\n├── <span class=\"token keyword\">package</span><span class=\"token punctuation\">.</span>json\n├── san<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>js\n└── ui<span class=\"token punctuation\">.</span>js         <span class=\"token comment\">// San UI 集成（这里存放插件的配置信息）</span></code></pre>\n<p>在开发环境下可以运行<code>npm run serve</code>，发布时运行<code>npm run build</code>。</p>\n<h3 id=\"2.-%E5%AE%9E%E7%8E%B0\"><a class=\"header-anchor\" href=\"#2.-%E5%AE%9E%E7%8E%B0\">#</a> 2. 实现</h3>\n<p>实现自定义组件，在src/index.js中，通过cli ui提供的ClientAddonApi将组件定义挂载到全局，打开文件中的<a href=\"https://github.com/amazing-js/san-cli-ui-widget-tiny-image/blob/master/src/index.js\"><code>src/index.js</code></a></p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> TinyImage <span class=\"token keyword\">from</span> <span class=\"token string\">'./components/tiny-image'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> locales <span class=\"token keyword\">from</span> <span class=\"token string\">'./locales.json'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* global ClientAddonApi */</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>ClientAddonApi<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 扩展语言文案</span>\n    ClientAddonApi<span class=\"token punctuation\">.</span><span class=\"token function\">addLocales</span><span class=\"token punctuation\">(</span>locales<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// 注册一个自定义组件</span>\n    ClientAddonApi<span class=\"token punctuation\">.</span><span class=\"token function\">defineComponent</span><span class=\"token punctuation\">(</span><span class=\"token string\">'san.widgets.components.tiny-image'</span><span class=\"token punctuation\">,</span> TinyImage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<blockquote>\n<p>注意：ClientAddonApi.defineComponent注册的id值在所有插件中唯一</p>\n</blockquote>\n<h3 id=\"3.-%E6%B3%A8%E5%86%8C\"><a class=\"header-anchor\" href=\"#3.-%E6%B3%A8%E5%86%8C\">#</a> 3. 注册</h3>\n<p>在<a href=\"https://github.com/amazing-js/san-cli-ui-widget-tiny-image/blob/master/ui.js\"><code>ui.js</code></a>中，使用 <code>api.addClientAddon</code> 方法并指定构建后加载的id和路径：</p>\n<pre class=\"language-js\"><code class=\"language-js\">\nmodule<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">api</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">SAN_CLI_UI_DEV</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 自定义的环境变量，在开发环境下</span>\n        api<span class=\"token punctuation\">.</span><span class=\"token function\">registerAddon</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            id<span class=\"token operator\">:</span> <span class=\"token string\">'san.widgets.client-addon.dev1'</span><span class=\"token punctuation\">,</span>\n            url<span class=\"token operator\">:</span> <span class=\"token string\">'http://localhost:8891/index.js'</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        api<span class=\"token punctuation\">.</span><span class=\"token function\">registerAddon</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            id<span class=\"token operator\">:</span> <span class=\"token string\">'san.widgets.tiny-image.client-addon'</span><span class=\"token punctuation\">,</span>\n            path<span class=\"token operator\">:</span> <span class=\"token string\">'san-cli-ui-widget-tiny-image'</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>可以在开发环境指定id和url，在正式环境指定npm包内的构建后的dist路径</p>\n<blockquote>\n<p>注意：此处开发环境的url端口应与第一步中san.config.js的port端口相同</p>\n</blockquote>\n<h3 id=\"4.-%E6%98%BE%E7%A4%BA\"><a class=\"header-anchor\" href=\"#4.-%E6%98%BE%E7%A4%BA\">#</a> 4. 显示</h3>\n<p>加载路径配置完毕，可以继续配置自定义的部件在显示位置，在<a href=\"https://github.com/amazing-js/san-cli-ui-widget-tiny-image/blob/master/ui.js\">ui.js</a>中，通过调用<code>api.registerWidget</code>来定义显示到dashboard的组件</p>\n<pre class=\"language-js\"><code class=\"language-js\">\t <span class=\"token comment\">// tiny-image</span>\n    api<span class=\"token punctuation\">.</span><span class=\"token function\">registerWidget</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        id<span class=\"token operator\">:</span> <span class=\"token string\">'san.widgets.tiny-image'</span><span class=\"token punctuation\">,</span>\n        title<span class=\"token operator\">:</span> <span class=\"token string\">'san-cli-ui-widget-tiny-image.title'</span><span class=\"token punctuation\">,</span>\n        description<span class=\"token operator\">:</span> <span class=\"token string\">'san-cli-ui-widget-tiny-image.description'</span><span class=\"token punctuation\">,</span>\n        icon<span class=\"token operator\">:</span> <span class=\"token string\">'file-image'</span><span class=\"token punctuation\">,</span>\n        component<span class=\"token operator\">:</span> <span class=\"token string\">'san.widgets.components.tiny-image'</span><span class=\"token punctuation\">,</span>\n        minWidth<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        minHeight<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        maxWidth<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        maxHeight<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        maxCount<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// 增加压缩选项配置</span>\n        <span class=\"token function-variable function\">defaultConfig</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            quality<span class=\"token operator\">:</span> <span class=\"token number\">0.8</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">async</span> <span class=\"token function\">onConfigOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n                prompts<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                    <span class=\"token punctuation\">{</span>\n                        name<span class=\"token operator\">:</span> <span class=\"token string\">'quality'</span><span class=\"token punctuation\">,</span>\n                        type<span class=\"token operator\">:</span> <span class=\"token string\">'input'</span><span class=\"token punctuation\">,</span>\n                        message<span class=\"token operator\">:</span> <span class=\"token string\">'san-cli-ui-widget-tiny-image.prompts.quality'</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token function-variable function\">validate</span><span class=\"token operator\">:</span> <span class=\"token parameter\">input</span> <span class=\"token operator\">=></span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span>input\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>还可使用<code>api.onAction</code>用于监听组件内的事件，组件内的调用方式，例如（具体说明见<a href=\"https://ecomfe.github.io/san-cli/#/ui/start\">文档</a>）：</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>results<span class=\"token punctuation\">,</span> errors<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$callPluginAction</span><span class=\"token punctuation\">(</span><span class=\"token string\">'san.widgets.actions.fetch-news'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    url<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'widget.config.url'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    force\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>以上就是一个 addon 代码，注册了 <code>san.widgets.tiny-image</code> 组件</p>\n<h3 id=\"5.-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%8A%A0%E8%BD%BD%E5%8F%8A%E8%B0%83%E8%AF%95\"><a class=\"header-anchor\" href=\"#5.-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%8A%A0%E8%BD%BD%E5%8F%8A%E8%B0%83%E8%AF%95\">#</a> 5. 在项目中加载及调试</h3>\n<p><strong>原理</strong>：在每个安装好的 san-cli 插件里，cli-ui 都会尝试从其插件的根目录加载一个可选的 <code>ui.js</code> 文件。在插件的tab下安装的npm包，会将插件安装到具体项目的依赖中，plugin初始化查找时，会遍历package.json中的dependencies和devDependencies，找到插件后会读取<code>ui.js</code>进而加载新的插件。</p>\n<ol>\n<li>\n<p>插件包中执行<code>npm run start</code>启动插件本地服务</p>\n</li>\n<li>\n<p>由于已经安装的san-cli-ui是生产环境，因此需要对插件的ui.js进行修改：</p>\n<pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">api</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 直接加载本地调试端口地址，调试完成后再恢复</span>\n    api<span class=\"token punctuation\">.</span><span class=\"token function\">registerAddon</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        id<span class=\"token operator\">:</span> <span class=\"token string\">'san.widgets.client-addon.dev1'</span><span class=\"token punctuation\">,</span>\n        url<span class=\"token operator\">:</span> <span class=\"token string\">'http://localhost:8891/index.js'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n</li>\n<li>\n<p>使得san-li可以加载到插件的ui.js配置，有两种方案选择其一即可：</p>\n<ul>\n<li>\n<p>通过san cli依赖读取：在cli打开的san项目对应的package.json的依赖中手动加入新包的名字，在项目的node_modules下增加新包文件夹，只需包含刚才修改的 <code>ui.js</code> 文件即可，目的是确保CLI在读取依赖时，可以读取到新增组件的配置，之后重启项目</p>\n</li>\n<li>\n<p>通过san cli ui读取默认插件配置：在san-cli依赖的包中找到san-cli-ui目录，修改<code>/xxx/san-cli/node_modules/san-cli-ui/plugins/index.js</code>，此文件为san cli ui的内置插件，增加待调试的插件配置项：</p>\n<pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">api</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n    <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/xxx/san-cli-plugin-tools/ui'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>api<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 引入新的npm包配置</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n</li>\n</ul>\n<p>以上任选一种只需确保cli ui可以读取到新包的ui配置即可</p>\n</li>\n</ol>\n<p>调试完毕后，恢复<code>ui.js</code> 的配置，执行<code>npm run build</code> + <code>npm publish</code>完成包的发布。在<code>san ui</code>的插件管理中搜索并安装插件即可。</p>\n</div>","toc":{"level":0,"children":[{"level":2,"title":"addon组件的定义","hash":"addon%E7%BB%84%E4%BB%B6%E7%9A%84%E5%AE%9A%E4%B9%89"},{"level":2,"title":"addon挂载的基本步骤","hash":"addon%E6%8C%82%E8%BD%BD%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%AD%A5%E9%AA%A4"},{"level":2,"title":"Dashboard接入自定义部件widget","hash":"dashboard%E6%8E%A5%E5%85%A5%E8%87%AA%E5%AE%9A%E4%B9%89%E9%83%A8%E4%BB%B6widget","children":[{"level":3,"title":"1. 创建一个addon组件的工程","hash":"1.-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAaddon%E7%BB%84%E4%BB%B6%E7%9A%84%E5%B7%A5%E7%A8%8B"},{"level":3,"title":"2. 实现","hash":"2.-%E5%AE%9E%E7%8E%B0"},{"level":3,"title":"3. 注册","hash":"3.-%E6%B3%A8%E5%86%8C"},{"level":3,"title":"4. 显示","hash":"4.-%E6%98%BE%E7%A4%BA"},{"level":3,"title":"5. 在项目中加载及调试","hash":"5.-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%8A%A0%E8%BD%BD%E5%8F%8A%E8%B0%83%E8%AF%95"}]}]},"title":"San CLI","base":"/san-cli/","themeConfig":{"nav":[{"text":"San","link":"https://baidu.github.io/san/"},{"text":"Santd","link":"https://ecomfe.github.io/santd/"}],"sidebar":{"/":{"children":[{"path":"/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/README.md","title":"介绍"},{"title":"基础命令","children":[{"path":"/create-project/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/create-project.md","title":"初始化项目"},{"path":"/serve/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/serve.md","title":"开发打包"},{"path":"/build/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/build.md","title":"生产打包"}]},{"title":"配置","children":[{"path":"/config/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/config.md","title":"San CLI 配置文件"},{"path":"/advanced/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/advanced.md","title":"高级配置"},{"path":"/presets/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/presets.md","title":"Presets 预设"},{"path":"/env/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/env.md","title":"环境变量"}]},{"title":"常见解决方案","children":[{"path":"/modern-mode/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/modern-mode.md","title":"现在的浏览器打包模式"},{"path":"/bundle-analyze/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/bundle-analyze.md","title":"Bundle 分析"},{"path":"/component/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/component.md","title":"San Component 组件开发"},{"path":"/smarty/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/smarty.md","title":"Smarty 相关"},{"path":"/deployment/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/deployment.md","title":"部署"},{"path":"/hulk-cli-migration/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/hulk-cli-migration.md","title":"hulk-cli升级san-cli"}]},{"title":"二次开发","children":[{"path":"/architecture/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/architecture.md","title":"内部实现"},{"path":"/create-scaffold/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/create-scaffold.md","title":"如何创建一个脚手架项目"},{"path":"/plugin/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/plugin.md","title":"插件","children":[{"path":"/cmd-plugin/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/cmd-plugin.md","title":"Command 插件"},{"path":"/srv-plugin/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/srv-plugin.md","title":"编写一个 Serivce 插件"}]}]},{"title":"CLI UI","children":[{"path":"/ui/start/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/start.md","title":"CLI UI安装"},{"title":"功能简介","children":[{"path":"/ui/project-list/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/project-list.md","title":"项目列表"},{"path":"/ui/dashboard/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/dashboard.md","title":"仪表盘"},{"path":"/ui/plugin/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/plugin.md","title":"插件管理"},{"path":"/ui/dependency/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/dependency.md","title":"依赖管理"},{"path":"/ui/configuration/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/configuration.md","title":"配置管理"},{"path":"/ui/task/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/task.md","title":"任务管理"}]},{"title":"插件开发","children":[{"path":"/ui/structure/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/structure.md","title":"CLI UI 插件"},{"path":"/ui/plugin-object/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/plugin-object.md","title":"PluginManager对象"},{"path":"/ui/add-addon/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/add-addon.md","title":"addon组件"},{"path":"/ui/add-config/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/add-config.md","title":"添加项目配置"},{"path":"/ui/cover-task/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/cover-task.md","title":"任务管理"},{"path":"/ui/add-view/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/add-view.md","title":"添加自定义视图"},{"path":"/ui/static/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/static.md","title":"公共静态文件"}]}]}]}}}},"docit":{"pathname":"ui/add-addon/index","content":"<div class=\"markdown\"><h1 id=\"addon%E7%BB%84%E4%BB%B6\"><a class=\"header-anchor\" href=\"#addon%E7%BB%84%E4%BB%B6\">#</a> addon组件</h1>\n<h2 id=\"addon%E7%BB%84%E4%BB%B6%E7%9A%84%E5%AE%9A%E4%B9%89\"><a class=\"header-anchor\" href=\"#addon%E7%BB%84%E4%BB%B6%E7%9A%84%E5%AE%9A%E4%B9%89\">#</a> addon组件的定义</h2>\n<p><strong>addon组件</strong>：是一个动态加载到cli-ui的js包，其结构满足CLI插件的默认包结构。项目的仪表盘内显示的部件widget、任务内的显示视图view等，都称为addon，均以单独的npm包形式存在。</p>\n<p>外部addon的，主要借助两个api实现在cli ui内的显示：</p>\n<ol>\n<li><code>api.registerAddon</code>：注册一个addon，定义加载的addon id及路径。</li>\n<li><code>api.registerWidget</code>/<code>api.registerTask</code>：注册一个widget组件/view组件，用于将自定义组件加载到dashboard/task视图内。</li>\n</ol>\n<h2 id=\"addon%E6%8C%82%E8%BD%BD%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%AD%A5%E9%AA%A4\"><a class=\"header-anchor\" href=\"#addon%E6%8C%82%E8%BD%BD%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%AD%A5%E9%AA%A4\">#</a> addon挂载的基本步骤</h2>\n<ul>\n<li>创建：创建一个addon的项目，可以为单独的npm包或者在已有的插件内增加</li>\n<li>实现：编写index.js实现自定义组件，通过cli ui提供的<code>ClientAddonApi</code>将组件定义挂载到全局</li>\n<li>注册：在ui.js文件中调用<code>api.addClientAddon</code>指定构建后的js包加载路径</li>\n<li>显示：在ui.js文件中调用指定api挂载到指定视图内，例如api.registerWidget注册组件到dashboard</li>\n</ul>\n<p>在开发addon组件过程中，会涉及到以下api：</p>\n<ul>\n<li><code>api.registerAddon</code>：addon组件注册</li>\n<li><code>api.registerWidget</code>：widget部件注册</li>\n<li><code>api.callAction</code>：事件调用</li>\n<li><code>api.onAction</code>：事件监听</li>\n<li><code>ClientAddonApi.defineComponent</code>：组件定义</li>\n<li><code>ClientAddonApi.addLocales</code>：组件扩展语言</li>\n</ul>\n<p>接下来以实际例子来展示插件的开发过程。</p>\n<h2 id=\"dashboard%E6%8E%A5%E5%85%A5%E8%87%AA%E5%AE%9A%E4%B9%89%E9%83%A8%E4%BB%B6widget\"><a class=\"header-anchor\" href=\"#dashboard%E6%8E%A5%E5%85%A5%E8%87%AA%E5%AE%9A%E4%B9%89%E9%83%A8%E4%BB%B6widget\">#</a> Dashboard接入自定义部件widget</h2>\n<p>cli ui提供了将自定义组件挂载到项目仪表盘的方式，通过此功能，你可以定制属于自己的个性仪表盘，也可将小工具分享给更多的人使用。</p>\n<p>接下来以一个逐步讲解一个新增自定义widget部件的过程，这里以图片压缩小部件<code>san-cli-ui-widget-tiny-image</code>为例，点击下文的链接可随时点击查看源码。</p>\n<h3 id=\"1.-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAaddon%E7%BB%84%E4%BB%B6%E7%9A%84%E5%B7%A5%E7%A8%8B\"><a class=\"header-anchor\" href=\"#1.-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAaddon%E7%BB%84%E4%BB%B6%E7%9A%84%E5%B7%A5%E7%A8%8B\">#</a> 1. 创建一个addon组件的工程</h3>\n<p>推荐使用san cli创建一个新的项目，作为开发依赖安装san-cli-ui，在san.config.js中填写如下内容（<a href=\"https://github.com/amazing-js/san-cli-ui-widget-tiny-image/blob/master/san.config.js\">demo参考</a>）：</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> clientAddonConfig <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'san-cli-ui/client-addon-config'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span><span class=\"token function\">clientAddonConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        id<span class=\"token operator\">:</span> <span class=\"token string\">'san.webpack.client-addon.widget.tiny-image'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 名称唯一</span>\n        port<span class=\"token operator\">:</span> <span class=\"token number\">8891</span> <span class=\"token comment\">// 端口可变</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n<blockquote>\n<p>注意：id应设置正确的命名，且在所有插件中保持唯一</p>\n</blockquote>\n<p>通过<code>clientAddonConfig</code>可生成san.config.js的默认配置，打包出的代码输出到<code>./dist/index.js</code>。</p>\n<p>demo目录结构如下：</p>\n<pre class=\"language-js\"><code class=\"language-js\">san<span class=\"token operator\">-</span>cli<span class=\"token operator\">-</span>ui<span class=\"token operator\">-</span>widget<span class=\"token operator\">-</span>tiny<span class=\"token operator\">-</span>image\n├── <span class=\"token constant\">README</span><span class=\"token punctuation\">.</span>md\n├── src\n      ├──components\n│     └── index<span class=\"token punctuation\">.</span>js\n├── <span class=\"token keyword\">package</span><span class=\"token punctuation\">.</span>json\n├── san<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">.</span>js\n└── ui<span class=\"token punctuation\">.</span>js         <span class=\"token comment\">// San UI 集成（这里存放插件的配置信息）</span></code></pre>\n<p>在开发环境下可以运行<code>npm run serve</code>，发布时运行<code>npm run build</code>。</p>\n<h3 id=\"2.-%E5%AE%9E%E7%8E%B0\"><a class=\"header-anchor\" href=\"#2.-%E5%AE%9E%E7%8E%B0\">#</a> 2. 实现</h3>\n<p>实现自定义组件，在src/index.js中，通过cli ui提供的ClientAddonApi将组件定义挂载到全局，打开文件中的<a href=\"https://github.com/amazing-js/san-cli-ui-widget-tiny-image/blob/master/src/index.js\"><code>src/index.js</code></a></p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> TinyImage <span class=\"token keyword\">from</span> <span class=\"token string\">'./components/tiny-image'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> locales <span class=\"token keyword\">from</span> <span class=\"token string\">'./locales.json'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* global ClientAddonApi */</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>ClientAddonApi<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 扩展语言文案</span>\n    ClientAddonApi<span class=\"token punctuation\">.</span><span class=\"token function\">addLocales</span><span class=\"token punctuation\">(</span>locales<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// 注册一个自定义组件</span>\n    ClientAddonApi<span class=\"token punctuation\">.</span><span class=\"token function\">defineComponent</span><span class=\"token punctuation\">(</span><span class=\"token string\">'san.widgets.components.tiny-image'</span><span class=\"token punctuation\">,</span> TinyImage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<blockquote>\n<p>注意：ClientAddonApi.defineComponent注册的id值在所有插件中唯一</p>\n</blockquote>\n<h3 id=\"3.-%E6%B3%A8%E5%86%8C\"><a class=\"header-anchor\" href=\"#3.-%E6%B3%A8%E5%86%8C\">#</a> 3. 注册</h3>\n<p>在<a href=\"https://github.com/amazing-js/san-cli-ui-widget-tiny-image/blob/master/ui.js\"><code>ui.js</code></a>中，使用 <code>api.addClientAddon</code> 方法并指定构建后加载的id和路径：</p>\n<pre class=\"language-js\"><code class=\"language-js\">\nmodule<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">api</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">SAN_CLI_UI_DEV</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 自定义的环境变量，在开发环境下</span>\n        api<span class=\"token punctuation\">.</span><span class=\"token function\">registerAddon</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            id<span class=\"token operator\">:</span> <span class=\"token string\">'san.widgets.client-addon.dev1'</span><span class=\"token punctuation\">,</span>\n            url<span class=\"token operator\">:</span> <span class=\"token string\">'http://localhost:8891/index.js'</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        api<span class=\"token punctuation\">.</span><span class=\"token function\">registerAddon</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            id<span class=\"token operator\">:</span> <span class=\"token string\">'san.widgets.tiny-image.client-addon'</span><span class=\"token punctuation\">,</span>\n            path<span class=\"token operator\">:</span> <span class=\"token string\">'san-cli-ui-widget-tiny-image'</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>可以在开发环境指定id和url，在正式环境指定npm包内的构建后的dist路径</p>\n<blockquote>\n<p>注意：此处开发环境的url端口应与第一步中san.config.js的port端口相同</p>\n</blockquote>\n<h3 id=\"4.-%E6%98%BE%E7%A4%BA\"><a class=\"header-anchor\" href=\"#4.-%E6%98%BE%E7%A4%BA\">#</a> 4. 显示</h3>\n<p>加载路径配置完毕，可以继续配置自定义的部件在显示位置，在<a href=\"https://github.com/amazing-js/san-cli-ui-widget-tiny-image/blob/master/ui.js\">ui.js</a>中，通过调用<code>api.registerWidget</code>来定义显示到dashboard的组件</p>\n<pre class=\"language-js\"><code class=\"language-js\">\t <span class=\"token comment\">// tiny-image</span>\n    api<span class=\"token punctuation\">.</span><span class=\"token function\">registerWidget</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        id<span class=\"token operator\">:</span> <span class=\"token string\">'san.widgets.tiny-image'</span><span class=\"token punctuation\">,</span>\n        title<span class=\"token operator\">:</span> <span class=\"token string\">'san-cli-ui-widget-tiny-image.title'</span><span class=\"token punctuation\">,</span>\n        description<span class=\"token operator\">:</span> <span class=\"token string\">'san-cli-ui-widget-tiny-image.description'</span><span class=\"token punctuation\">,</span>\n        icon<span class=\"token operator\">:</span> <span class=\"token string\">'file-image'</span><span class=\"token punctuation\">,</span>\n        component<span class=\"token operator\">:</span> <span class=\"token string\">'san.widgets.components.tiny-image'</span><span class=\"token punctuation\">,</span>\n        minWidth<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        minHeight<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        maxWidth<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        maxHeight<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n        maxCount<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// 增加压缩选项配置</span>\n        <span class=\"token function-variable function\">defaultConfig</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            quality<span class=\"token operator\">:</span> <span class=\"token number\">0.8</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">async</span> <span class=\"token function\">onConfigOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n                prompts<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                    <span class=\"token punctuation\">{</span>\n                        name<span class=\"token operator\">:</span> <span class=\"token string\">'quality'</span><span class=\"token punctuation\">,</span>\n                        type<span class=\"token operator\">:</span> <span class=\"token string\">'input'</span><span class=\"token punctuation\">,</span>\n                        message<span class=\"token operator\">:</span> <span class=\"token string\">'san-cli-ui-widget-tiny-image.prompts.quality'</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token function-variable function\">validate</span><span class=\"token operator\">:</span> <span class=\"token parameter\">input</span> <span class=\"token operator\">=></span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span>input\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>还可使用<code>api.onAction</code>用于监听组件内的事件，组件内的调用方式，例如（具体说明见<a href=\"https://ecomfe.github.io/san-cli/#/ui/start\">文档</a>）：</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>results<span class=\"token punctuation\">,</span> errors<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$callPluginAction</span><span class=\"token punctuation\">(</span><span class=\"token string\">'san.widgets.actions.fetch-news'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    url<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'widget.config.url'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    force\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>以上就是一个 addon 代码，注册了 <code>san.widgets.tiny-image</code> 组件</p>\n<h3 id=\"5.-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%8A%A0%E8%BD%BD%E5%8F%8A%E8%B0%83%E8%AF%95\"><a class=\"header-anchor\" href=\"#5.-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%8A%A0%E8%BD%BD%E5%8F%8A%E8%B0%83%E8%AF%95\">#</a> 5. 在项目中加载及调试</h3>\n<p><strong>原理</strong>：在每个安装好的 san-cli 插件里，cli-ui 都会尝试从其插件的根目录加载一个可选的 <code>ui.js</code> 文件。在插件的tab下安装的npm包，会将插件安装到具体项目的依赖中，plugin初始化查找时，会遍历package.json中的dependencies和devDependencies，找到插件后会读取<code>ui.js</code>进而加载新的插件。</p>\n<ol>\n<li>\n<p>插件包中执行<code>npm run start</code>启动插件本地服务</p>\n</li>\n<li>\n<p>由于已经安装的san-cli-ui是生产环境，因此需要对插件的ui.js进行修改：</p>\n<pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">api</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 直接加载本地调试端口地址，调试完成后再恢复</span>\n    api<span class=\"token punctuation\">.</span><span class=\"token function\">registerAddon</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        id<span class=\"token operator\">:</span> <span class=\"token string\">'san.widgets.client-addon.dev1'</span><span class=\"token punctuation\">,</span>\n        url<span class=\"token operator\">:</span> <span class=\"token string\">'http://localhost:8891/index.js'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n</li>\n<li>\n<p>使得san-li可以加载到插件的ui.js配置，有两种方案选择其一即可：</p>\n<ul>\n<li>\n<p>通过san cli依赖读取：在cli打开的san项目对应的package.json的依赖中手动加入新包的名字，在项目的node_modules下增加新包文件夹，只需包含刚才修改的 <code>ui.js</code> 文件即可，目的是确保CLI在读取依赖时，可以读取到新增组件的配置，之后重启项目</p>\n</li>\n<li>\n<p>通过san cli ui读取默认插件配置：在san-cli依赖的包中找到san-cli-ui目录，修改<code>/xxx/san-cli/node_modules/san-cli-ui/plugins/index.js</code>，此文件为san cli ui的内置插件，增加待调试的插件配置项：</p>\n<pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">api</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n    <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/xxx/san-cli-plugin-tools/ui'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>api<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 引入新的npm包配置</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n</li>\n</ul>\n<p>以上任选一种只需确保cli ui可以读取到新包的ui配置即可</p>\n</li>\n</ol>\n<p>调试完毕后，恢复<code>ui.js</code> 的配置，执行<code>npm run build</code> + <code>npm publish</code>完成包的发布。在<code>san ui</code>的插件管理中搜索并安装插件即可。</p>\n</div>","toc":{"level":0,"children":[{"level":2,"title":"addon组件的定义","hash":"addon%E7%BB%84%E4%BB%B6%E7%9A%84%E5%AE%9A%E4%B9%89"},{"level":2,"title":"addon挂载的基本步骤","hash":"addon%E6%8C%82%E8%BD%BD%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%AD%A5%E9%AA%A4"},{"level":2,"title":"Dashboard接入自定义部件widget","hash":"dashboard%E6%8E%A5%E5%85%A5%E8%87%AA%E5%AE%9A%E4%B9%89%E9%83%A8%E4%BB%B6widget","children":[{"level":3,"title":"1. 创建一个addon组件的工程","hash":"1.-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAaddon%E7%BB%84%E4%BB%B6%E7%9A%84%E5%B7%A5%E7%A8%8B"},{"level":3,"title":"2. 实现","hash":"2.-%E5%AE%9E%E7%8E%B0"},{"level":3,"title":"3. 注册","hash":"3.-%E6%B3%A8%E5%86%8C"},{"level":3,"title":"4. 显示","hash":"4.-%E6%98%BE%E7%A4%BA"},{"level":3,"title":"5. 在项目中加载及调试","hash":"5.-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%8A%A0%E8%BD%BD%E5%8F%8A%E8%B0%83%E8%AF%95"}]}]},"title":"San CLI","base":"/san-cli/","themeConfig":{"nav":[{"text":"San","link":"https://baidu.github.io/san/"},{"text":"Santd","link":"https://ecomfe.github.io/santd/"}],"sidebar":{"/":{"children":[{"path":"/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/README.md","title":"介绍"},{"title":"基础命令","children":[{"path":"/create-project/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/create-project.md","title":"初始化项目"},{"path":"/serve/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/serve.md","title":"开发打包"},{"path":"/build/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/build.md","title":"生产打包"}]},{"title":"配置","children":[{"path":"/config/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/config.md","title":"San CLI 配置文件"},{"path":"/advanced/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/advanced.md","title":"高级配置"},{"path":"/presets/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/presets.md","title":"Presets 预设"},{"path":"/env/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/env.md","title":"环境变量"}]},{"title":"常见解决方案","children":[{"path":"/modern-mode/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/modern-mode.md","title":"现在的浏览器打包模式"},{"path":"/bundle-analyze/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/bundle-analyze.md","title":"Bundle 分析"},{"path":"/component/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/component.md","title":"San Component 组件开发"},{"path":"/smarty/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/smarty.md","title":"Smarty 相关"},{"path":"/deployment/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/deployment.md","title":"部署"},{"path":"/hulk-cli-migration/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/hulk-cli-migration.md","title":"hulk-cli升级san-cli"}]},{"title":"二次开发","children":[{"path":"/architecture/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/architecture.md","title":"内部实现"},{"path":"/create-scaffold/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/create-scaffold.md","title":"如何创建一个脚手架项目"},{"path":"/plugin/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/plugin.md","title":"插件","children":[{"path":"/cmd-plugin/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/cmd-plugin.md","title":"Command 插件"},{"path":"/srv-plugin/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/srv-plugin.md","title":"编写一个 Serivce 插件"}]}]},{"title":"CLI UI","children":[{"path":"/ui/start/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/start.md","title":"CLI UI安装"},{"title":"功能简介","children":[{"path":"/ui/project-list/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/project-list.md","title":"项目列表"},{"path":"/ui/dashboard/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/dashboard.md","title":"仪表盘"},{"path":"/ui/plugin/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/plugin.md","title":"插件管理"},{"path":"/ui/dependency/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/dependency.md","title":"依赖管理"},{"path":"/ui/configuration/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/configuration.md","title":"配置管理"},{"path":"/ui/task/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/task.md","title":"任务管理"}]},{"title":"插件开发","children":[{"path":"/ui/structure/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/structure.md","title":"CLI UI 插件"},{"path":"/ui/plugin-object/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/plugin-object.md","title":"PluginManager对象"},{"path":"/ui/add-addon/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/add-addon.md","title":"addon组件"},{"path":"/ui/add-config/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/add-config.md","title":"添加项目配置"},{"path":"/ui/cover-task/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/cover-task.md","title":"任务管理"},{"path":"/ui/add-view/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/add-view.md","title":"添加自定义视图"},{"path":"/ui/static/","filename":"/Volumes/Source/san/san-cli-all/san-cli-github/docs/ui/static.md","title":"公共静态文件"}]}]}]}}}}}--><header id="header"><a href="/san-cli/" class="navbar"><img src="/san-cli/logo.svg" alt="Home" class="logo"> <span>San CLI</span></a><ul><li><a target="_blank" href="https://baidu.github.io/san/">San</a></li><li><a target="_blank" href="https://ecomfe.github.io/santd/">Santd</a></li></ul></header><aside id="sidebar"><ul class="tree"><li data-id="/"><a href="/san-cli/">介绍</a></li><li><span>基础命令</span><ul><li data-id="/create-project/"><a href="/san-cli/create-project/">初始化项目</a></li><li data-id="/serve/"><a href="/san-cli/serve/">开发打包</a></li><li data-id="/build/"><a href="/san-cli/build/">生产打包</a></li></ul></li><li><span>配置</span><ul><li data-id="/config/"><a href="/san-cli/config/">San CLI 配置文件</a></li><li data-id="/advanced/"><a href="/san-cli/advanced/">高级配置</a></li><li data-id="/presets/"><a href="/san-cli/presets/">Presets 预设</a></li><li data-id="/env/"><a href="/san-cli/env/">环境变量</a></li></ul></li><li><span>常见解决方案</span><ul><li data-id="/modern-mode/"><a href="/san-cli/modern-mode/">现在的浏览器打包模式</a></li><li data-id="/bundle-analyze/"><a href="/san-cli/bundle-analyze/">Bundle 分析</a></li><li data-id="/component/"><a href="/san-cli/component/">San Component 组件开发</a></li><li data-id="/smarty/"><a href="/san-cli/smarty/">Smarty 相关</a></li><li data-id="/deployment/"><a href="/san-cli/deployment/">部署</a></li><li data-id="/hulk-cli-migration/"><a href="/san-cli/hulk-cli-migration/">hulk-cli升级san-cli</a></li></ul></li><li><span>二次开发</span><ul><li data-id="/architecture/"><a href="/san-cli/architecture/">内部实现</a></li><li data-id="/create-scaffold/"><a href="/san-cli/create-scaffold/">如何创建一个脚手架项目</a></li><li data-id="/plugin/"><a href="/san-cli/plugin/">插件</a><ul><li data-id="/cmd-plugin/"><a href="/san-cli/cmd-plugin/">Command 插件</a></li><li data-id="/srv-plugin/"><a href="/san-cli/srv-plugin/">编写一个 Serivce 插件</a></li></ul></li></ul></li><li><span>CLI UI</span><ul><li data-id="/ui/start/"><a href="/san-cli/ui/start/">CLI UI安装</a></li><li><span>功能简介</span><ul><li data-id="/ui/project-list/"><a href="/san-cli/ui/project-list/">项目列表</a></li><li data-id="/ui/dashboard/"><a href="/san-cli/ui/dashboard/">仪表盘</a></li><li data-id="/ui/plugin/"><a href="/san-cli/ui/plugin/">插件管理</a></li><li data-id="/ui/dependency/"><a href="/san-cli/ui/dependency/">依赖管理</a></li><li data-id="/ui/configuration/"><a href="/san-cli/ui/configuration/">配置管理</a></li><li data-id="/ui/task/"><a href="/san-cli/ui/task/">任务管理</a></li></ul></li><li><span>插件开发</span><ul><li data-id="/ui/structure/"><a href="/san-cli/ui/structure/">CLI UI 插件</a></li><li data-id="/ui/plugin-object/"><a href="/san-cli/ui/plugin-object/">PluginManager对象</a></li><li data-id="/ui/add-addon/"><a href="/san-cli/ui/add-addon/">addon组件</a></li><li data-id="/ui/add-config/"><a href="/san-cli/ui/add-config/">添加项目配置</a></li><li data-id="/ui/cover-task/"><a href="/san-cli/ui/cover-task/">任务管理</a></li><li data-id="/ui/add-view/"><a href="/san-cli/ui/add-view/">添加自定义视图</a></li><li data-id="/ui/static/"><a href="/san-cli/ui/static/">公共静态文件</a></li></ul></li></ul></li></ul></aside><article id="content"><div id="router-view" class="router-view"><!--s-text--><div class="markdown"><h1 id="addon%E7%BB%84%E4%BB%B6"><a class="header-anchor" href="#addon%E7%BB%84%E4%BB%B6">#</a> addon组件</h1><h2 id="addon%E7%BB%84%E4%BB%B6%E7%9A%84%E5%AE%9A%E4%B9%89"><a class="header-anchor" href="#addon%E7%BB%84%E4%BB%B6%E7%9A%84%E5%AE%9A%E4%B9%89">#</a> addon组件的定义</h2><p><strong>addon组件</strong>：是一个动态加载到cli-ui的js包，其结构满足CLI插件的默认包结构。项目的仪表盘内显示的部件widget、任务内的显示视图view等，都称为addon，均以单独的npm包形式存在。</p><p>外部addon的，主要借助两个api实现在cli ui内的显示：</p><ol><li><code>api.registerAddon</code>：注册一个addon，定义加载的addon id及路径。</li><li><code>api.registerWidget</code>/<code>api.registerTask</code>：注册一个widget组件/view组件，用于将自定义组件加载到dashboard/task视图内。</li></ol><h2 id="addon%E6%8C%82%E8%BD%BD%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%AD%A5%E9%AA%A4"><a class="header-anchor" href="#addon%E6%8C%82%E8%BD%BD%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%AD%A5%E9%AA%A4">#</a> addon挂载的基本步骤</h2><ul><li>创建：创建一个addon的项目，可以为单独的npm包或者在已有的插件内增加</li><li>实现：编写index.js实现自定义组件，通过cli ui提供的<code>ClientAddonApi</code>将组件定义挂载到全局</li><li>注册：在ui.js文件中调用<code>api.addClientAddon</code>指定构建后的js包加载路径</li><li>显示：在ui.js文件中调用指定api挂载到指定视图内，例如api.registerWidget注册组件到dashboard</li></ul><p>在开发addon组件过程中，会涉及到以下api：</p><ul><li><code>api.registerAddon</code>：addon组件注册</li><li><code>api.registerWidget</code>：widget部件注册</li><li><code>api.callAction</code>：事件调用</li><li><code>api.onAction</code>：事件监听</li><li><code>ClientAddonApi.defineComponent</code>：组件定义</li><li><code>ClientAddonApi.addLocales</code>：组件扩展语言</li></ul><p>接下来以实际例子来展示插件的开发过程。</p><h2 id="dashboard%E6%8E%A5%E5%85%A5%E8%87%AA%E5%AE%9A%E4%B9%89%E9%83%A8%E4%BB%B6widget"><a class="header-anchor" href="#dashboard%E6%8E%A5%E5%85%A5%E8%87%AA%E5%AE%9A%E4%B9%89%E9%83%A8%E4%BB%B6widget">#</a> Dashboard接入自定义部件widget</h2><p>cli ui提供了将自定义组件挂载到项目仪表盘的方式，通过此功能，你可以定制属于自己的个性仪表盘，也可将小工具分享给更多的人使用。</p><p>接下来以一个逐步讲解一个新增自定义widget部件的过程，这里以图片压缩小部件<code>san-cli-ui-widget-tiny-image</code>为例，点击下文的链接可随时点击查看源码。</p><h3 id="1.-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAaddon%E7%BB%84%E4%BB%B6%E7%9A%84%E5%B7%A5%E7%A8%8B"><a class="header-anchor" href="#1.-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAaddon%E7%BB%84%E4%BB%B6%E7%9A%84%E5%B7%A5%E7%A8%8B">#</a> 1. 创建一个addon组件的工程</h3><p>推荐使用san cli创建一个新的项目，作为开发依赖安装san-cli-ui，在san.config.js中填写如下内容（<a href="https://github.com/amazing-js/san-cli-ui-widget-tiny-image/blob/master/san.config.js">demo参考</a>）：</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> clientAddonConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'san-cli-ui/client-addon-config'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token function">clientAddonConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        id<span class="token operator">:</span> <span class="token string">'san.webpack.client-addon.widget.tiny-image'</span><span class="token punctuation">,</span> <span class="token comment">// 名称唯一</span>
        port<span class="token operator">:</span> <span class="token number">8891</span> <span class="token comment">// 端口可变</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><blockquote><p>注意：id应设置正确的命名，且在所有插件中保持唯一</p></blockquote><p>通过<code>clientAddonConfig</code>可生成san.config.js的默认配置，打包出的代码输出到<code>./dist/index.js</code>。</p><p>demo目录结构如下：</p><pre class="language-js"><code class="language-js">san<span class="token operator">-</span>cli<span class="token operator">-</span>ui<span class="token operator">-</span>widget<span class="token operator">-</span>tiny<span class="token operator">-</span>image
├── <span class="token constant">README</span><span class="token punctuation">.</span>md
├── src
      ├──components
│     └── index<span class="token punctuation">.</span>js
├── <span class="token keyword">package</span><span class="token punctuation">.</span>json
├── san<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js
└── ui<span class="token punctuation">.</span>js         <span class="token comment">// San UI 集成（这里存放插件的配置信息）</span></code></pre><p>在开发环境下可以运行<code>npm run serve</code>，发布时运行<code>npm run build</code>。</p><h3 id="2.-%E5%AE%9E%E7%8E%B0"><a class="header-anchor" href="#2.-%E5%AE%9E%E7%8E%B0">#</a> 2. 实现</h3><p>实现自定义组件，在src/index.js中，通过cli ui提供的ClientAddonApi将组件定义挂载到全局，打开文件中的<a href="https://github.com/amazing-js/san-cli-ui-widget-tiny-image/blob/master/src/index.js"><code>src/index.js</code></a></p><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> TinyImage <span class="token keyword">from</span> <span class="token string">'./components/tiny-image'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> locales <span class="token keyword">from</span> <span class="token string">'./locales.json'</span><span class="token punctuation">;</span>

<span class="token comment">/* global ClientAddonApi */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>ClientAddonApi<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 扩展语言文案</span>
    ClientAddonApi<span class="token punctuation">.</span><span class="token function">addLocales</span><span class="token punctuation">(</span>locales<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 注册一个自定义组件</span>
    ClientAddonApi<span class="token punctuation">.</span><span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token string">'san.widgets.components.tiny-image'</span><span class="token punctuation">,</span> TinyImage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><blockquote><p>注意：ClientAddonApi.defineComponent注册的id值在所有插件中唯一</p></blockquote><h3 id="3.-%E6%B3%A8%E5%86%8C"><a class="header-anchor" href="#3.-%E6%B3%A8%E5%86%8C">#</a> 3. 注册</h3><p>在<a href="https://github.com/amazing-js/san-cli-ui-widget-tiny-image/blob/master/ui.js"><code>ui.js</code></a>中，使用 <code>api.addClientAddon</code> 方法并指定构建后加载的id和路径：</p><pre class="language-js"><code class="language-js">
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">api</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">SAN_CLI_UI_DEV</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 自定义的环境变量，在开发环境下</span>
        api<span class="token punctuation">.</span><span class="token function">registerAddon</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            id<span class="token operator">:</span> <span class="token string">'san.widgets.client-addon.dev1'</span><span class="token punctuation">,</span>
            url<span class="token operator">:</span> <span class="token string">'http://localhost:8891/index.js'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        api<span class="token punctuation">.</span><span class="token function">registerAddon</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            id<span class="token operator">:</span> <span class="token string">'san.widgets.tiny-image.client-addon'</span><span class="token punctuation">,</span>
            path<span class="token operator">:</span> <span class="token string">'san-cli-ui-widget-tiny-image'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>可以在开发环境指定id和url，在正式环境指定npm包内的构建后的dist路径</p><blockquote><p>注意：此处开发环境的url端口应与第一步中san.config.js的port端口相同</p></blockquote><h3 id="4.-%E6%98%BE%E7%A4%BA"><a class="header-anchor" href="#4.-%E6%98%BE%E7%A4%BA">#</a> 4. 显示</h3><p>加载路径配置完毕，可以继续配置自定义的部件在显示位置，在<a href="https://github.com/amazing-js/san-cli-ui-widget-tiny-image/blob/master/ui.js">ui.js</a>中，通过调用<code>api.registerWidget</code>来定义显示到dashboard的组件</p><pre class="language-js"><code class="language-js">	 <span class="token comment">// tiny-image</span>
    api<span class="token punctuation">.</span><span class="token function">registerWidget</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        id<span class="token operator">:</span> <span class="token string">'san.widgets.tiny-image'</span><span class="token punctuation">,</span>
        title<span class="token operator">:</span> <span class="token string">'san-cli-ui-widget-tiny-image.title'</span><span class="token punctuation">,</span>
        description<span class="token operator">:</span> <span class="token string">'san-cli-ui-widget-tiny-image.description'</span><span class="token punctuation">,</span>
        icon<span class="token operator">:</span> <span class="token string">'file-image'</span><span class="token punctuation">,</span>
        component<span class="token operator">:</span> <span class="token string">'san.widgets.components.tiny-image'</span><span class="token punctuation">,</span>
        minWidth<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        minHeight<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        maxWidth<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        maxHeight<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        maxCount<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token comment">// 增加压缩选项配置</span>
        <span class="token function-variable function">defaultConfig</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
            quality<span class="token operator">:</span> <span class="token number">0.8</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">async</span> <span class="token function">onConfigOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                prompts<span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                        name<span class="token operator">:</span> <span class="token string">'quality'</span><span class="token punctuation">,</span>
                        type<span class="token operator">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>
                        message<span class="token operator">:</span> <span class="token string">'san-cli-ui-widget-tiny-image.prompts.quality'</span><span class="token punctuation">,</span>
                        <span class="token function-variable function">validate</span><span class="token operator">:</span> <span class="token parameter">input</span> <span class="token operator">=></span> <span class="token operator">!</span><span class="token operator">!</span>input
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>还可使用<code>api.onAction</code>用于监听组件内的事件，组件内的调用方式，例如（具体说明见<a href="https://ecomfe.github.io/san-cli/#/ui/start">文档</a>）：</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span>results<span class="token punctuation">,</span> errors<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$callPluginAction</span><span class="token punctuation">(</span><span class="token string">'san.widgets.actions.fetch-news'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    url<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'widget.config.url'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    force
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>以上就是一个 addon 代码，注册了 <code>san.widgets.tiny-image</code> 组件</p><h3 id="5.-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%8A%A0%E8%BD%BD%E5%8F%8A%E8%B0%83%E8%AF%95"><a class="header-anchor" href="#5.-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%8A%A0%E8%BD%BD%E5%8F%8A%E8%B0%83%E8%AF%95">#</a> 5. 在项目中加载及调试</h3><p><strong>原理</strong>：在每个安装好的 san-cli 插件里，cli-ui 都会尝试从其插件的根目录加载一个可选的 <code>ui.js</code> 文件。在插件的tab下安装的npm包，会将插件安装到具体项目的依赖中，plugin初始化查找时，会遍历package.json中的dependencies和devDependencies，找到插件后会读取<code>ui.js</code>进而加载新的插件。</p><ol><li><p>插件包中执行<code>npm run start</code>启动插件本地服务</p></li><li><p>由于已经安装的san-cli-ui是生产环境，因此需要对插件的ui.js进行修改：</p><pre class="language-js"><code class="language-js">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">api</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// 直接加载本地调试端口地址，调试完成后再恢复</span>
    api<span class="token punctuation">.</span><span class="token function">registerAddon</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        id<span class="token operator">:</span> <span class="token string">'san.widgets.client-addon.dev1'</span><span class="token punctuation">,</span>
        url<span class="token operator">:</span> <span class="token string">'http://localhost:8891/index.js'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></li><li><p>使得san-li可以加载到插件的ui.js配置，有两种方案选择其一即可：</p><ul><li><p>通过san cli依赖读取：在cli打开的san项目对应的package.json的依赖中手动加入新包的名字，在项目的node_modules下增加新包文件夹，只需包含刚才修改的 <code>ui.js</code> 文件即可，目的是确保CLI在读取依赖时，可以读取到新增组件的配置，之后重启项目</p></li><li><p>通过san cli ui读取默认插件配置：在san-cli依赖的包中找到san-cli-ui目录，修改<code>/xxx/san-cli/node_modules/san-cli-ui/plugins/index.js</code>，此文件为san cli ui的内置插件，增加待调试的插件配置项：</p><pre class="language-js"><code class="language-js">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">api</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'/xxx/san-cli-plugin-tools/ui'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>api<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 引入新的npm包配置</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></li></ul><p>以上任选一种只需确保cli ui可以读取到新包的ui配置即可</p></li></ol><p>调试完毕后，恢复<code>ui.js</code> 的配置，执行<code>npm run build</code> + <code>npm publish</code>完成包的发布。在<code>san ui</code>的插件管理中搜索并安装插件即可。</p></div><!--/s-text--></div><aside class="toc"><ul class="tree"><li data-id="addon%E7%BB%84%E4%BB%B6%E7%9A%84%E5%AE%9A%E4%B9%89"><a href="/san-cliui/add-addon/index#addon%E7%BB%84%E4%BB%B6%E7%9A%84%E5%AE%9A%E4%B9%89">addon组件的定义</a></li><li data-id="addon%E6%8C%82%E8%BD%BD%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%AD%A5%E9%AA%A4"><a href="/san-cliui/add-addon/index#addon%E6%8C%82%E8%BD%BD%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%AD%A5%E9%AA%A4">addon挂载的基本步骤</a></li><li data-id="dashboard%E6%8E%A5%E5%85%A5%E8%87%AA%E5%AE%9A%E4%B9%89%E9%83%A8%E4%BB%B6widget"><a href="/san-cliui/add-addon/index#dashboard%E6%8E%A5%E5%85%A5%E8%87%AA%E5%AE%9A%E4%B9%89%E9%83%A8%E4%BB%B6widget">Dashboard接入自定义部件widget</a><ul><li data-id="1.-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAaddon%E7%BB%84%E4%BB%B6%E7%9A%84%E5%B7%A5%E7%A8%8B"><a href="/san-cliui/add-addon/index#1.-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAaddon%E7%BB%84%E4%BB%B6%E7%9A%84%E5%B7%A5%E7%A8%8B">1. 创建一个addon组件的工程</a></li><li data-id="2.-%E5%AE%9E%E7%8E%B0"><a href="/san-cliui/add-addon/index#2.-%E5%AE%9E%E7%8E%B0">2. 实现</a></li><li data-id="3.-%E6%B3%A8%E5%86%8C"><a href="/san-cliui/add-addon/index#3.-%E6%B3%A8%E5%86%8C">3. 注册</a></li><li data-id="4.-%E6%98%BE%E7%A4%BA"><a href="/san-cliui/add-addon/index#4.-%E6%98%BE%E7%A4%BA">4. 显示</a></li><li data-id="5.-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%8A%A0%E8%BD%BD%E5%8F%8A%E8%B0%83%E8%AF%95"><a href="/san-cliui/add-addon/index#5.-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%8A%A0%E8%BD%BD%E5%8F%8A%E8%B0%83%E8%AF%95">5. 在项目中加载及调试</a></li></ul></li></ul></aside></article></div></div><script src="/san-cli/static/js/chunk-vendors.js"></script><script src="/san-cli/static/js/client-entry.js"></script></body></html>